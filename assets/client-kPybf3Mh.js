import{d as s,b as J,Z,G as K}from"./ai-vendor-Cr1lv8uJ.js";import{s as V}from"./index-CXwPkIaI.js";const H=Symbol("Let zodToJsonSchema decide on which parser to use"),M={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},W=e=>typeof e=="string"?{...M,name:e}:{...M,...e},Y=e=>{const t=W(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([a,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,a],jsonSchema:void 0}]))}};function L(e,t,n,a){a!=null&&a.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function p(e,t,n,a,r){e[t]=n,L(e,t,a,r)}const R=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function y(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?R(t,e.currentPath):t.join("/")}}function Q(e,t){var a,r,i;const n={type:"array"};return(a=e.type)!=null&&a._def&&((i=(r=e.type)==null?void 0:r._def)==null?void 0:i.typeName)!==s.ZodAny&&(n.items=m(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&p(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&p(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(p(n,"minItems",e.exactLength.value,e.exactLength.message,t),p(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function X(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const a of e.checks)switch(a.kind){case"min":t.target==="jsonSchema7"?a.inclusive?p(n,"minimum",a.value,a.message,t):p(n,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(n.exclusiveMinimum=!0),p(n,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?p(n,"maximum",a.value,a.message,t):p(n,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(n.exclusiveMaximum=!0),p(n,"maximum",a.value,a.message,t));break;case"multipleOf":p(n,"multipleOf",a.value,a.message,t);break}return n}function ee(){return{type:"boolean"}}function F(e,t){return m(e.type._def,t)}const te=(e,t)=>m(e.innerType._def,t);function C(e,t,n){const a=n??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((r,i)=>C(e,t,r))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ne(e,t)}}const ne=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const a of e.checks)switch(a.kind){case"min":p(n,"minimum",a.value,a.message,t);break;case"max":p(n,"maximum",a.value,a.message,t);break}return n};function ae(e,t){return{...m(e.innerType._def,t),default:e.defaultValue()}}function re(e,t){return t.effectStrategy==="input"?m(e.schema._def,t):y(t)}function ie(e){return{type:"string",enum:Array.from(e.values)}}const oe=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function se(e,t){const n=[m(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),m(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(i=>!!i);let a=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const r=[];return n.forEach(i=>{if(oe(i))r.push(...i.allOf),i.unevaluatedProperties===void 0&&(a=void 0);else{let o=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:l,...c}=i;o=c}else a=void 0;r.push(o)}}),r.length?{allOf:r,...a}:void 0}function ue(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let S;const f={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(S===void 0&&(S=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),S),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function z(e,t){const n={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":p(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t);break;case"max":p(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":h(n,"email",a.message,t);break;case"format:idn-email":h(n,"idn-email",a.message,t);break;case"pattern:zod":g(n,f.email,a.message,t);break}break;case"url":h(n,"uri",a.message,t);break;case"uuid":h(n,"uuid",a.message,t);break;case"regex":g(n,a.regex,a.message,t);break;case"cuid":g(n,f.cuid,a.message,t);break;case"cuid2":g(n,f.cuid2,a.message,t);break;case"startsWith":g(n,RegExp(`^${w(a.value,t)}`),a.message,t);break;case"endsWith":g(n,RegExp(`${w(a.value,t)}$`),a.message,t);break;case"datetime":h(n,"date-time",a.message,t);break;case"date":h(n,"date",a.message,t);break;case"time":h(n,"time",a.message,t);break;case"duration":h(n,"duration",a.message,t);break;case"length":p(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t),p(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"includes":{g(n,RegExp(w(a.value,t)),a.message,t);break}case"ip":{a.version!=="v6"&&h(n,"ipv4",a.message,t),a.version!=="v4"&&h(n,"ipv6",a.message,t);break}case"base64url":g(n,f.base64url,a.message,t);break;case"jwt":g(n,f.jwt,a.message,t);break;case"cidr":{a.version!=="v6"&&g(n,f.ipv4Cidr,a.message,t),a.version!=="v4"&&g(n,f.ipv6Cidr,a.message,t);break}case"emoji":g(n,f.emoji(),a.message,t);break;case"ulid":{g(n,f.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{h(n,"binary",a.message,t);break}case"contentEncoding:base64":{p(n,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{g(n,f.base64,a.message,t);break}}break}case"nanoid":g(n,f.nanoid,a.message,t)}return n}function w(e,t){return t.patternStrategy==="escape"?le(e):e}const ce=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function le(e){let t="";for(let n=0;n<e.length;n++)ce.has(e[n])||(t+="\\"),t+=e[n];return t}function h(e,t,n,a){var r;e.format||(r=e.anyOf)!=null&&r.some(i=>i.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&a.errorMessages&&{errorMessage:{format:n}}})):p(e,"format",t,n,a)}function g(e,t,n,a){var r;e.pattern||(r=e.allOf)!=null&&r.some(i=>i.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:j(t,a),...n&&a.errorMessages&&{errorMessage:{pattern:n}}})):p(e,"pattern",j(t,a),n,a)}function j(e,t){var c;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=n.i?e.source.toLowerCase():e.source;let r="",i=!1,o=!1,l=!1;for(let u=0;u<a.length;u++){if(i){r+=a[u],i=!1;continue}if(n.i){if(o){if(a[u].match(/[a-z]/)){l?(r+=a[u],r+=`${a[u-2]}-${a[u]}`.toUpperCase(),l=!1):a[u+1]==="-"&&((c=a[u+2])!=null&&c.match(/[a-z]/))?(r+=a[u],l=!0):r+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){r+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){r+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){r+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){r+=o?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}r+=a[u],a[u]==="\\"?i=!0:o&&a[u]==="]"?o=!1:!o&&a[u]==="["&&(o=!0)}try{new RegExp(r)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return r}function G(e,t){var a,r,i,o,l,c;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((a=e.keyType)==null?void 0:a._def.typeName)===s.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((u,d)=>({...u,[d]:m(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",d]})??y(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:m(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(((r=e.keyType)==null?void 0:r._def.typeName)===s.ZodString&&((i=e.keyType._def.checks)!=null&&i.length)){const{type:u,...d}=z(e.keyType._def,t);return{...n,propertyNames:d}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===s.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((l=e.keyType)==null?void 0:l._def.typeName)===s.ZodBranded&&e.keyType._def.type._def.typeName===s.ZodString&&((c=e.keyType._def.type._def.checks)!=null&&c.length)){const{type:u,...d}=F(e.keyType._def,t);return{...n,propertyNames:d}}}return n}function me(e,t){if(t.mapStrategy==="record")return G(e,t);const n=m(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||y(t),a=m(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||y(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,a],minItems:2,maxItems:2}}}function pe(e){const t=e.values,a=Object.keys(e.values).filter(i=>typeof t[t[i]]!="number").map(i=>t[i]),r=Array.from(new Set(a.map(i=>typeof i)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function de(e){return e.target==="openAi"?void 0:{not:y({...e,currentPath:[...e.currentPath,"not"]})}}function ge(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const _={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ye(e,t){if(t.target==="openApi3")return I(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(a=>a._def.typeName in _&&(!a._def.checks||!a._def.checks.length))){const a=n.reduce((r,i)=>{const o=_[i._def.typeName];return o&&!r.includes(o)?[...r,o]:r},[]);return{type:a.length>1?a:a[0]}}else if(n.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){const a=n.reduce((r,i)=>{const o=typeof i._def.value;switch(o){case"string":case"number":case"boolean":return[...r,o];case"bigint":return[...r,"integer"];case"object":if(i._def.value===null)return[...r,"null"];case"symbol":case"undefined":case"function":default:return r}},[]);if(a.length===n.length){const r=a.filter((i,o,l)=>l.indexOf(i)===o);return{type:r.length>1?r:r[0],enum:n.reduce((i,o)=>i.includes(o._def.value)?i:[...i,o._def.value],[])}}}else if(n.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((a,r)=>[...a,...r._def.values.filter(i=>!a.includes(i))],[])};return I(e,t)}const I=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((a,r)=>m(a._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(a=>!!a&&(!t.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return n.length?{anyOf:n}:void 0};function fe(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:_[e.innerType._def.typeName],nullable:!0}:{type:[_[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const a=m(e.innerType._def,{...t,currentPath:[...t.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}const n=m(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function he(e,t){const n={type:"number"};if(!e.checks)return n;for(const a of e.checks)switch(a.kind){case"int":n.type="integer",L(n,"type",a.message,t);break;case"min":t.target==="jsonSchema7"?a.inclusive?p(n,"minimum",a.value,a.message,t):p(n,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(n.exclusiveMinimum=!0),p(n,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?p(n,"maximum",a.value,a.message,t):p(n,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(n.exclusiveMaximum=!0),p(n,"maximum",a.value,a.message,t));break;case"multipleOf":p(n,"multipleOf",a.value,a.message,t);break}return n}function be(e,t){const n=t.target==="openAi",a={type:"object",properties:{}},r=[],i=e.shape();for(const l in i){let c=i[l];if(c===void 0||c._def===void 0)continue;let u=Ae(c);u&&n&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);const d=m(c._def,{...t,currentPath:[...t.currentPath,"properties",l],propertyPath:[...t.currentPath,"properties",l]});d!==void 0&&(a.properties[l]=d,u||r.push(l))}r.length&&(a.required=r);const o=ve(e,t);return o!==void 0&&(a.additionalProperties=o),a}function ve(e,t){if(e.catchall._def.typeName!=="ZodNever")return m(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Ae(e){try{return e.isOptional()}catch{return!0}}const Pe=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return m(e.innerType._def,t);const n=m(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:y(t)},n]}:y(t)},ke=(e,t)=>{if(t.pipeStrategy==="input")return m(e.in._def,t);if(t.pipeStrategy==="output")return m(e.out._def,t);const n=m(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=m(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,a].filter(r=>r!==void 0)}};function _e(e,t){return m(e.type._def,t)}function Se(e,t){const a={type:"array",uniqueItems:!0,items:m(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&p(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&p(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}function we(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,a)=>m(n._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((n,a)=>a===void 0?n:[...n,a],[]),additionalItems:m(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,a)=>m(n._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((n,a)=>a===void 0?n:[...n,a],[])}}function Oe(e){return{not:y(e)}}function Te(e){return y(e)}const Ze=(e,t)=>m(e.innerType._def,t),Me=(e,t,n)=>{switch(t){case s.ZodString:return z(e,n);case s.ZodNumber:return he(e,n);case s.ZodObject:return be(e,n);case s.ZodBigInt:return X(e,n);case s.ZodBoolean:return ee();case s.ZodDate:return C(e,n);case s.ZodUndefined:return Oe(n);case s.ZodNull:return ge(n);case s.ZodArray:return Q(e,n);case s.ZodUnion:case s.ZodDiscriminatedUnion:return ye(e,n);case s.ZodIntersection:return se(e,n);case s.ZodTuple:return we(e,n);case s.ZodRecord:return G(e,n);case s.ZodLiteral:return ue(e,n);case s.ZodEnum:return ie(e);case s.ZodNativeEnum:return pe(e);case s.ZodNullable:return fe(e,n);case s.ZodOptional:return Pe(e,n);case s.ZodMap:return me(e,n);case s.ZodSet:return Se(e,n);case s.ZodLazy:return()=>e.getter()._def;case s.ZodPromise:return _e(e,n);case s.ZodNaN:case s.ZodNever:return de(n);case s.ZodEffects:return re(e,n);case s.ZodAny:return y(n);case s.ZodUnknown:return Te(n);case s.ZodDefault:return ae(e,n);case s.ZodBranded:return F(e,n);case s.ZodReadonly:return Ze(e,n);case s.ZodCatch:return te(e,n);case s.ZodPipeline:return ke(e,n);case s.ZodFunction:case s.ZodVoid:case s.ZodSymbol:return;default:return(a=>{})()}};function m(e,t,n=!1){var l;const a=t.seen.get(e);if(t.override){const c=(l=t.override)==null?void 0:l.call(t,e,t,a,n);if(c!==H)return c}if(a&&!n){const c=je(a,t);if(c!==void 0)return c}const r={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,r);const i=Me(e,e.typeName,t),o=typeof i=="function"?m(i(),t):i;if(o&&Ie(e,t,o),t.postProcess){const c=t.postProcess(o,e,t);return r.jsonSchema=o,c}return r.jsonSchema=o,o}const je=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:R(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,a)=>t.currentPath[a]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),y(t)):t.$refStrategy==="seen"?y(t):void 0}},Ie=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),xe=(e,t)=>{const n=Y(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((c,[u,d])=>({...c,[u]:m(d._def,{...n,currentPath:[...n.basePath,n.definitionPath,u]},!0)??y(n)}),{}):void 0;const r=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,i=m(e._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??y(n),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(i.title=o),n.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[n.openAiAnyTypeName]||(a[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const l=r===void 0?a?{...i,[n.definitionPath]:a}:i:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...a,[r]:i}};return n.target==="jsonSchema7"?l.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l};var k={};const v="gemini-1.5-flash",De="llama-3.3-70b-versatile",Ge="llama-3.1-8b-instant",x=45e3;let A=!1,D=!1,T=0;const Ne=()=>Date.now()<T,q=(e="gemini")=>{if(e==="groq")return"gsk_HGqeFBigNGnDohHsJC4YW"+"Gdyb3FYM4mTySHqwIHUzpn2eXLIHkkA";if(A)return"";if(typeof import.meta<"u"){const t="AIzaSyCZHqCpnsR9ysgQFUki5Vld4Dj7eMMv9n0";if(N(t))return t}if(typeof process<"u"&&(k!=null&&k.GEMINI_API_KEY)){const t=k.GEMINI_API_KEY;if(N(t))return t}return""},N=e=>!(!e||!e.startsWith("AIza")||e.toUpperCase().includes("PLACEHOLDER")||e.length<35);let O=null;const $e=()=>{if(A)return null;const e=q("gemini");return e?(O||(O=new K(e)),O):null},Ee=async e=>{var t;if(console.log(`[AI Request] Provider: ${e.provider||"default (gemini)"}, Model: ${e.model||v}`),e.provider==="groq")return E(e);if(!A){const n=$e();if(n)try{return await Re(n,e)}catch(a){((t=a.message)!=null&&t.includes("404")||a.status===404)&&(console.warn("[AI] Model restricted or invalid key. Switching to network bridge..."),A=!0)}}if(!D)try{return await Fe(e)}catch(n){const a=n.message||"";a.includes("502")||a.includes("Timeout")?(console.warn("[AI] Network bridge unstable (502/Timeout). Using backup..."),D=!0):a.includes("UPSTREAM_ERROR")&&(console.groupCollapsed("[AI] Provider Alert"),console.log("Details:",a),console.groupEnd())}return console.log("[AI] Safety net activated (Groq)"),await E(e)},Le=async(e,t)=>{const n=Date.now();let a=null,r="";const i=e.provider!=="groq"&&!A;let o={...e,jsonMode:!0};if(i){const c=xe(t,{target:"jsonSchema7"});o.responseSchema=c}const l=async(c=!1,u)=>{try{let d={...o};if(c&&u){console.warn(`[AI Client] Attempting self-repair. Error: ${u}`);const B=`

CRITICAL: Your previous response was invalid JSON or missed schema requirements. 
Validation Error: ${u}
Fix the structure to match the schema exactly.`;d.systemInstruction=(d.systemInstruction||"")+B}r=await Ee(d);const b=r.replace(/^```(?:json)?|```$/gi,"").trim(),P=JSON.parse(b),U=t.parse(P);return $({provider:e.provider||"gemini",model:e.model||v,durationMs:Date.now()-n,success:!0,timestamp:Date.now(),inputTokens:0,outputTokens:r.length/4}),c&&console.log("[AI Client] Self-repair COMPLETE."),U}catch(d){if(!c){let b="Invalid JSON format";return d instanceof Z?b=d.errors.map(P=>`Field '${P.path.join(".")}' is invalid: ${P.message}`).join("; "):d instanceof SyntaxError&&(b="JSON Syntax Error: "+d.message),await l(!0,b)}throw a=d,console.error("Structured Generation Error (Final). Raw Text Preview:",r.substring(0,200)),d instanceof Z?new Error(`AI Schema Validation Failed after repair: ${d.errors.map(b=>`${b.path.join(".")}: ${b.message}`).join(", ")}`):new Error("Failed to parse or validate AI response after retries.")}};try{return await l(!1)}finally{a&&$({provider:e.provider||"gemini",model:e.model||v,durationMs:Date.now()-n,success:!1,errorCode:a.message||"Unknown Error",timestamp:Date.now()})}},qe=async e=>Le(e,J()),$=e=>{console.debug(`[TELEMETRY] ${JSON.stringify(e)}`)};async function Re(e,t){return(await e.getGenerativeModel({model:t.model||v,systemInstruction:t.systemInstruction}).generateContent({contents:[{role:"user",parts:[{text:t.prompt}]}],generationConfig:{temperature:t.temperature??.7,responseMimeType:t.jsonMode?"application/json":"text/plain"}})).response.text()}async function Fe(e){const{data:t,error:n}=await V.functions.invoke("gemini-proxy",{body:{prompt:e.prompt,model:e.model||v,systemInstruction:e.systemInstruction,temperature:e.temperature,jsonMode:e.jsonMode}});if(n)throw new Error(`Proxy Error: ${n.message||"Unknown error"}`);if(!t||!t.text)throw new Error("Proxy Error: Invalid response format from edge function");return t.text}async function E(e){var i,o,l;if(Ne()){const c=Math.ceil((T-Date.now())/1e3);throw new Error(`Groq temporalmente bloqueado (Rate Limit). Reintenta en ${c}s.`)}const t=q("groq");if(!t)throw new Error("No Groq API key available");let n=e.prompt;n.length>x&&(console.warn(`[Groq] Truncating prompt (${n.length} chars)`),n=n.substring(0,x)+`

[...TRUNCATED...]`);const a=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:e.model&&e.model.includes("llama")?e.model:De,messages:[...e.systemInstruction?[{role:"system",content:e.systemInstruction}]:[],{role:"user",content:n}],temperature:e.temperature??.7,response_format:e.jsonMode?{type:"json_object"}:void 0})});if(!a.ok){a.status===429&&(console.error("[Groq] Rate limit hit. Pausing service for 30s..."),T=Date.now()+3e4);const c=await a.json().catch(()=>({}));throw new Error(`Groq Error ${a.status}: ${((i=c.error)==null?void 0:i.message)||a.statusText}`)}return((l=(o=(await a.json()).choices[0])==null?void 0:o.message)==null?void 0:l.content)||""}export{De as G,qe as a,Ge as b,Ee as g};
